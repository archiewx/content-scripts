# React 合成事件 (synthetic event)

## react 事件注册

react 所有的事件注册在 `document` 上, 通过 `dispatchEvent` 函数统一分发

## 前置条件

合成事件依赖与浏览器事件 `冒泡机制`

## 合成事件和原生事件关系

- 合成事件依赖原生事件触发
- 若合成时阻止了冒泡，合成事件无法触发
- 原生事件先合成事件触发

### 意义

- 不同平台的统一的事件对象
- 原始的事件优化和升级, 例如原始 onchange 优化
- 性能提升

## 事件绑定流程

### 绑定

根据当前的组件实例获取到最高父级-也就是 document，然后执行方法 listenTo - 根据当前事件类型, 也是最关键的一个方法，进行事
件绑定处理。

### 存储

react 把所有的事件和事件类型以及 react 组件进行关联，把这个关系保存在了一个 map 里，也就是一个对象里（键值对），然后在事
件触发的时候去根据当前的组件 id 和事件类型查找到对应的事件 fn。

## 事件触发流程

- 在 document 上触发 `dispatchEvent` 函数
- 结合原生事件，找到该事件触发的 react 组件
- 进行事件合成
- 根据触发的事件类型，合成不同的事件对象
- 封装原生事件和冒泡机制
- 查找当前元素和它所有的父级元素
- 在 react 内部存储事件容器(listenerBank) 查找事件回调并合成事件
- 批量处理合成事件内的回调(合成事件触发结束)

## 原生事件和合成事件关系

- 合成事件依赖原生事件的冒泡
- 捕获阶段阻止目标元素任意父级元素事件，将会导致合成事件停止
- 冒泡阶段阻止document事件，不会对合成事件造成影响，阻止任意父级元素事件，导致合成事件不触发

> https://codesandbox.io/s/event-handler-9cy9wn 示例