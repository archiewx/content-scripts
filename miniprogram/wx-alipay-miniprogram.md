# 微信小程序和支付宝小程序

## 微信小程序

1. 微信小程序渲染: 微信小程序渲染基于 JavaScript 内核渲染，(在 ios 上基于 JavascriptCore, 在 android 上是基于 JSCore，也就是 X5 内核), 微信提供了一系列规范控件，断绝了原生宿主上的相关 API，只提供了纯 JavaScript 解释环境。在这套架构下，分为两个线程，渲染线程和逻辑线程，渲染线程负责页面渲染，逻辑线程负责维护虚拟节点树以及数据变更，状态变更。在这套模型下数据驱动 UI 变化，通过 `setData` 方式来实现的。setData 调用会让两个线程通信，从而在逻辑线程做虚拟节点比较，同时通知渲染线程更新下一次渲染界面。

- 事件处理上:小程序也遵循 web 开发规范，有两种事件监听机制，捕获和冒泡。这个过程也是由原生分发给虚拟节点的。
- 数据通信: 小程序是双线程模式，任何数据传递都是线程中通信，都会有一定延时。在小程序一切都会变成异步，这让各部分运行变的复杂了很多，例如首页渲染时候，渲染层必须拿到罗继承数据才能进行渲染，他们直接就有了强耦合关系，因为逻辑层和渲染层需要一定时序来保证顺序正确。在这里若要优化小程序性能，就必须减少线程沟通次数，最有效方式，就是批量去 setData
- 缓存机制: 每个小程序都有独立的存储空间，大小为 10M，超过后 setStorage 会失败。在这里需要考虑多用户情况，同一个机子可能登陆不同微信号，所以需要避免不同用户间信息泄露。更换机子后，原有数据不可以同步过去。这里就要求对一些关键数据要做服务端存储.

## 支付宝小程序

1. 支付小程序渲染: 全部采用 UC 内核渲染, 有下面几个好处: 内存优化（JS 内存和渲染内存），图片加载优化, 采用虚拟 dom 节点技术(WebAssembly)
2. 运行时: 分为两部分 Global Runtime 和 Local Runtime

- Global Runtime: 代表共享的装置和数据
- Local Runtime: 存放自生模块数据和私有数据, 不可共享
